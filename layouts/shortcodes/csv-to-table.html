<!--

shortcode for generating scrollable html tables from csv for my hugo website

generate it like this from your markdown file, drop file in /assets
< csv-to-table "games.csv" > (include double curly brackets on both sides, i cannot include them in the comment)

be careful about the csv format, i like to keep a simple "last modified date" in the second row and first column - the csv looks like this:

"Platform","Game","Date finished","Time spent","Rating","Review","Comment"
"2024-12-27","","","","","",""

if nothing is written in this cell, no last modified text is written at the bottom of the page

supports writing markdown inside the csv itself, can be used for stuff like links

-->

{{- with $file := .Get 0 -}}
  {{- with resources.Get $file -}}
    {{- with . | transform.Unmarshal -}}
    <!-- wrap in div to allow horizontal scrollbar -->
    <div style="overflow-x: auto;">
      <table>
        <thead>
          <tr>
            <!-- get heading -->
            {{ range index . 0 }}
              <th>{{ . }}</th>
            {{ end }}
          </tr>
        </thead>
        <tbody>
          <!-- start at third index, index 0 = header, index 1 = last modified -->
          {{ $data := after 2 . }}
          {{ range $data }}
            <tr>
              {{ range . }}
                <td>{{ . | markdownify }}</td>
              {{ end }}
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
    <!-- get second row, first column - used for last modified date -->
    {{ $modified := index (index . 1) 0 }}
    <!-- handle if list contains only one item and don't write last modified text if doesn't exist -->
    <p>{{ len $data }} {{if eq $data 1}}item{{else}}items{{end}}{{if len $modified }}, Last modified: {{ $modified }}{{end}}</p>
    {{ end }}
  {{ end }}
{{ end }}
